name: Update Dependencies

on:
  schedule:
    # Run every Monday at 9:00 AM UTC
    - cron: '0 9 * * 1'
  workflow_dispatch:

jobs:
  update-base-image:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v3

      - name: Build base image with latest packages
        run: |
          cd base
          docker build --no-cache -t modern-python-base:latest .
          
      - name: Test updated base image
        run: |
          docker run --rm modern-python-base:latest python --version
          docker run --rm modern-python-base:latest uv --version
          docker run --rm modern-python-base:latest ruff --version
          docker run --rm modern-python-base:latest pytest --version
          docker run --rm modern-python-base:latest mypy --version
          docker run --rm modern-python-base:latest safety --version

      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v5
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          commit-message: "chore: update development dependencies"
          title: "ðŸ”„ Update development dependencies"
          body: |
            ## ðŸ”„ Automated dependency update
            
            This PR updates the base development environment with the latest versions of all tools:
            
            - Python development tools (ruff, black, mypy, vulture)
            - Testing tools (pytest, pytest-cov, pytest-mock)
            - Security tools (safety, bandit)
            - Pre-commit hooks
            
            ### Changes
            - Rebuilt base Docker image with latest package versions
            - All tests passing
            
            ### Testing
            - âœ… Base image builds successfully
            - âœ… All tools are functional
            - âœ… Version compatibility verified
            
            This is an automated update generated by the weekly dependency update workflow.
          branch: update-dependencies
          delete-branch: true